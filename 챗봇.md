# ì˜œë‹¤ì •ë‹µ AI ì±—ë´‡ ê¸°ëŠ¥ ê°œë°œ ë…¸íŠ¸

## ğŸ“‹ ëª©ì°¨
1. [ê¸°ëŠ¥ ê°œìš”](#ê¸°ëŠ¥-ê°œìš”)
2. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
3. [íŒŒì¼ êµ¬ì¡°](#íŒŒì¼-êµ¬ì¡°)
4. [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
5. [êµ¬í˜„ ì„¸ë¶€ì‚¬í•­](#êµ¬í˜„-ì„¸ë¶€ì‚¬í•­)
6. [ë°ì´í„° ì €ì¥ êµ¬ì¡°](#ë°ì´í„°-ì €ì¥-êµ¬ì¡°)
7. [API êµ¬ì¡°](#api-êµ¬ì¡°)
8. [ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„](#ìŠ¤íŠ¸ë¦¬ë°-êµ¬í˜„)
9. [Langchain í†µí•©](#langchain-í†µí•©)
10. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
11. [í–¥í›„ ê°œì„  ì‚¬í•­](#í–¥í›„-ê°œì„ -ì‚¬í•­)

---

## ê¸°ëŠ¥ ê°œìš”

**ì˜œë‹¤ì •ë‹µ AI**ëŠ” ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œ í’€ì´ë¥¼ ë„ì™€ì£¼ëŠ” AI ì±—ë´‡ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ í‹°ì–´, í•´ê²°í•œ ë¬¸ì œ ìˆ˜, í˜„ì¬ í’€ê³  ìˆëŠ” ë¬¸ì œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§ì¶¤í˜• ì„¤ëª…ê³¼ íŒíŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•
- âœ… ë¬¸ì œì™€ í”„ë¡œí•„ ì •ë³´ ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹
- âœ… ì •ë‹µ ê°€ë¦¬ê¸° í† ê¸€ ê¸°ëŠ¥ (í•™ìŠµ ëª¨ë“œ ì§€ì›)
- âœ… í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ì„ íƒ (Python, Java, C++, JavaScript)
- âœ… ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (SSE)
- âœ… ëŒ€í™” ê¸°ë¡ ì˜êµ¬ ì €ì¥ (localStorage)
- âœ… Langchain ê¸°ë°˜ ëŒ€í™” ë©”ëª¨ë¦¬ ê´€ë¦¬

---

## ê¸°ìˆ  ìŠ¤íƒ

### í”„ë¡ íŠ¸ì—”ë“œ
- **React** (Next.js 14)
- **React Hooks** (useState, useEffect, useRef, useCallback)

### ë°±ì—”ë“œ
- **Next.js API Routes**
- **OpenAI API** (GPT-3.5 Turbo)
- **Langchain 1.x** (ëŒ€í™” ë©”ëª¨ë¦¬ ê´€ë¦¬)

### ì£¼ìš” íŒ¨í‚¤ì§€
```json
{
  "@langchain/openai": "^1.1.3",
  "@langchain/core": "^1.1.4",
  "langchain": "^1.1.5"
}
```

### ë°ì´í„° ì €ì¥
- **localStorage** (í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì˜êµ¬ ì €ì¥)

---

## íŒŒì¼ êµ¬ì¡°

```
ks-code-editor/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ chatbot/
â”‚           â””â”€â”€ route.js              # ì±—ë´‡ API ì—”ë“œí¬ì¸íŠ¸
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ viewers/
â”‚   â”‚   â””â”€â”€ ChatbotViewer.js          # ì±—ë´‡ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ Editor/
â”‚   â”‚   â””â”€â”€ EditorGroup.js            # ì—ë””í„° ê·¸ë£¹ (ì±—ë´‡ ë·°ì–´ í†µí•©)
â”‚   â””â”€â”€ Sidebar/
â”‚       â””â”€â”€ FileItem.js               # íŒŒì¼ ì•„ì´í…œ (ì±—ë´‡ ì•„ì´ì½˜)
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ skeletonCode.js               # íŠ¹ìˆ˜ íŒŒì¼ ì •ì˜
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ storage.js                    # localStorage ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ fileManager.js                # íŒŒì¼ ê´€ë¦¬ (ì±—ë´‡ íŒŒì¼ ì²˜ë¦¬)
â””â”€â”€ ì±—ë´‡.md                           # ì´ ë¬¸ì„œ
```

---

## ì£¼ìš” ê¸°ëŠ¥

### 1. íŠ¹ìˆ˜ íŒŒì¼: `ì˜œë‹¤ì •ë‹µ.ai`
- íŒŒì¼ íƒìƒ‰ê¸°ì— `GoCodeReview` ì•„ì´ì½˜ìœ¼ë¡œ í‘œì‹œ
- íŠ¹ìˆ˜ íŒŒì¼ë¡œ ë¶„ë¥˜ë˜ì–´ íŒŒì¼ ëª©ë¡ ìƒë‹¨ì— í‘œì‹œ
- í´ë¦­ ì‹œ `ChatbotViewer` ì»´í¬ë„ŒíŠ¸ ë Œë”ë§

### 2. ì»¨í…ìŠ¤íŠ¸ ì¸ì‹
- **ë¬¸ì œ ì •ë³´**: ë¬¸ì œ ë²ˆí˜¸, ì œëª©, ì„¤ëª…, ì˜ˆì œ ì…ë ¥/ì¶œë ¥
- **í”„ë¡œí•„ ì •ë³´**: ì‚¬ìš©ì í‹°ì–´, í•´ê²°í•œ ë¬¸ì œ ìˆ˜
- **ì–¸ì–´ ì„ íƒ**: ì„ íƒí•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì— ë§ëŠ” ì½”ë“œ ì˜ˆì‹œ ì œê³µ

### 3. ì •ë‹µ ê°€ë¦¬ê¸° í† ê¸€
- **OFF (ê¸°ë³¸ê°’)**: ì±—ë´‡ì´ ë¬¸ì œì˜ ì •ë‹µ ì½”ë“œë¥¼ ì œê³µ
- **ON**: ì±—ë´‡ì´ ì •ë‹µ ì½”ë“œë¥¼ ì œê³µí•˜ì§€ ì•Šê³  íŒíŠ¸ì™€ ì„¤ëª…ë§Œ ì œê³µ
- í•™ìŠµ ëª¨ë“œë¡œ ì‚¬ìš©ìê°€ ì§ì ‘ ê³ ë¯¼í•˜ê³  í’€ ìˆ˜ ìˆë„ë¡ ì§€ì›

### 4. ì–¸ì–´ ì„ íƒ ë“œë¡­ë‹¤ìš´
- ì§€ì› ì–¸ì–´: Python, Java, C++, JavaScript
- ì„ íƒí•œ ì–¸ì–´ì— ë§ëŠ” ì½”ë“œ ì˜ˆì‹œ ì œê³µ
- ì„¤ì •ì´ localStorageì— ì €ì¥ë˜ì–´ ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ìœ ì§€

### 5. ëŒ€í™” ê¸°ë¡ ê´€ë¦¬
- ëª¨ë“  ëŒ€í™” ê¸°ë¡ì´ localStorageì— ìë™ ì €ì¥
- ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ëŒ€í™” ê¸°ë¡ ìœ ì§€
- "ìƒˆ ëŒ€í™”" ë²„íŠ¼ìœ¼ë¡œ ëŒ€í™” ê¸°ë¡ ì´ˆê¸°í™”

### 6. ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
- SSE (Server-Sent Events)ë¥¼ í†µí•œ ì‹¤ì‹œê°„ ì‘ë‹µ ì¶œë ¥
- ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ (ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ ê°ì†Œ)

---

## êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 1. ChatbotViewer ì»´í¬ë„ŒíŠ¸

#### ìƒíƒœ ê´€ë¦¬
```javascript
const [messages, setMessages] = useState([]);           // ëŒ€í™” ë©”ì‹œì§€
const [input, setInput] = useState('');                 // ì…ë ¥ í•„ë“œ
const [isLoading, setIsLoading] = useState(false);      // ë¡œë”© ìƒíƒœ
const [hideAnswer, setHideAnswer] = useState(false);    // ì •ë‹µ ê°€ë¦¬ê¸° í† ê¸€
const [selectedLanguage, setSelectedLanguage] = useState('Python'); // ì„ íƒ ì–¸ì–´
const [problemInfo, setProblemInfo] = useState(null);   // ë¬¸ì œ ì •ë³´
const [profileInfo, setProfileInfo] = useState(null);   // í”„ë¡œí•„ ì •ë³´
```

#### ì£¼ìš” í•¨ìˆ˜
- `createSystemPromptWithInfo()`: ë¬¸ì œ/í”„ë¡œí•„ ì •ë³´ë¥¼ í¬í•¨í•œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
- `handleSend()`: ë©”ì‹œì§€ ì „ì†¡ ë° SSE ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
- `handleNewChat()`: ëŒ€í™” ê¸°ë¡ ì´ˆê¸°í™”

#### localStorage ë™ê¸°í™”
- ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ: ë¬¸ì œ/í”„ë¡œí•„ ì •ë³´, ëŒ€í™” ê¸°ë¡, ì„¤ì • ë¡œë“œ
- ë©”ì‹œì§€ ë³€ê²½ ì‹œ: ìë™ ì €ì¥
- ì„¤ì • ë³€ê²½ ì‹œ: ìë™ ì €ì¥

### 2. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ êµ¬ì¡°

```
ë‹¹ì‹ ì€ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œ í’€ì´ë¥¼ ë„ì™€ì£¼ëŠ” ì¹œì ˆí•œ ì„ ìƒë‹˜ì…ë‹ˆë‹¤.

[ì‚¬ìš©ì ì •ë³´]
- í‹°ì–´: {tier}
- í•´ê²°í•œ ë¬¸ì œ ìˆ˜: {solvedCount}

[í˜„ì¬ ë¬¸ì œ ì •ë³´]
- ë¬¸ì œ ë²ˆí˜¸: {problemNumber}
- ì œëª©: {title}
- ì„¤ëª…: {description}
- ì˜ˆì œ ì…ë ¥/ì¶œë ¥: {examples}

[ì„¤ì •]
- ì„ íƒ ì–¸ì–´: {language}
- ì •ë‹µ ê°€ë¦¬ê¸°: {hideAnswer ? 'ON' : 'OFF'}

[ì§€ì‹œì‚¬í•­]
- ì •ë‹µ ê°€ë¦¬ê¸°ê°€ ONì¼ ë•ŒëŠ” ì •ë‹µ ì½”ë“œë¥¼ ì œê³µí•˜ì§€ ì•ŠìŒ
- ì„ íƒí•œ ì–¸ì–´ë¡œ ì½”ë“œ ì˜ˆì‹œ ì œê³µ
- ì¹œì ˆí•˜ê³  ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…
```

### 3. ë©”ì‹œì§€ ì „ì†¡ íë¦„

```
1. ì‚¬ìš©ì ì…ë ¥
   â†“
2. ë¬¸ì œ/í”„ë¡œí•„ ì •ë³´ ê²€ì¦
   â†“
3. ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ messagesì— ì¶”ê°€
   â†“
4. ë¹ˆ assistant ë©”ì‹œì§€ ì´ˆê¸°í™” (ìŠ¤íŠ¸ë¦¬ë°ìš©)
   â†“
5. API ìš”ì²­ (ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ + ëŒ€í™” ê¸°ë¡)
   â†“
6. SSE ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ìˆ˜ì‹ 
   â†“
7. ì‹¤ì‹œê°„ìœ¼ë¡œ assistant ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
   â†“
8. ì™„ë£Œ í›„ localStorageì— ì €ì¥
```

---

## ë°ì´í„° ì €ì¥ êµ¬ì¡°

### localStorage í‚¤

| í‚¤ | ì„¤ëª… | ë°ì´í„° í˜•ì‹ |
|---|---|---|
| `kscode_problem_info` | ë¬¸ì œ ì •ë³´ | `{ number, title, description, ... }` |
| `kscode_profile_info` | í”„ë¡œí•„ ì •ë³´ | `{ tier, solvedCount, ... }` |
| `kscode_chatbot_messages` | ëŒ€í™” ê¸°ë¡ | `[{ role, content }, ...]` |
| `kscode_chatbot` | ì±—ë´‡ ì„¤ì • | `{ language, hideAnswer }` |

### ì €ì¥ í•¨ìˆ˜ (`lib/storage.js`)

```javascript
// ë¬¸ì œ ì •ë³´
saveProblemInfo(problemInfo)
loadProblemInfo()

// í”„ë¡œí•„ ì •ë³´
saveProfileInfo(profileInfo)
loadProfileInfo()

// ëŒ€í™” ê¸°ë¡
saveChatbotMessages(messages)
loadChatbotMessages()
clearChatbotMessages()

// ì±—ë´‡ ì„¤ì •
saveChatbotSettings({ language, hideAnswer })
loadChatbotSettings()
```

---

## API êµ¬ì¡°

### ì—”ë“œí¬ì¸íŠ¸: `POST /api/chatbot`

#### ìš”ì²­
```json
{
  "messages": [
    { "role": "system", "content": "ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸" },
    { "role": "user", "content": "ì‚¬ìš©ì ë©”ì‹œì§€" },
    { "role": "assistant", "content": "AI ì‘ë‹µ" },
    ...
  ],
  "hideAnswer": false
}
```

#### ì‘ë‹µ (SSE ìŠ¤íŠ¸ë¦¬ë°)
```
Content-Type: text/event-stream

data: {"text": "ì‘ë‹µ í…ìŠ¤íŠ¸", "done": false}
data: {"text": "ê³„ì†ë˜ëŠ” í…ìŠ¤íŠ¸", "done": false}
...
data: {"text": "", "done": true}
```

#### ì—ëŸ¬ ì‘ë‹µ
```json
{
  "error": "ì—ëŸ¬ ë©”ì‹œì§€",
  "message": "ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€"
}
```

---

## ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„

### ì„œë²„ ì¸¡ (API Route)

```javascript
// ReadableStreamìœ¼ë¡œ SSE ìƒì„±
const stream = new ReadableStream({
  async start(controller) {
    const encoder = new TextEncoder();
    
    // Langchain ìŠ¤íŠ¸ë¦¬ë°
    const streamResponse = await chainWithHistory.stream(
      { question: currentUserMessage.content },
      { configurable: { sessionId: sessionId } }
    );
    
    // ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬
    for await (const chunk of streamResponse) {
      const text = extractTextFromChunk(chunk);
      if (text) {
        const data = `data: ${JSON.stringify({ text, done: false })}\n\n`;
        controller.enqueue(encoder.encode(data));
      }
    }
    
    // ì™„ë£Œ ì‹ í˜¸
    const doneData = `data: ${JSON.stringify({ text: '', done: true })}\n\n`;
    controller.enqueue(encoder.encode(doneData));
    controller.close();
  }
});
```

### í´ë¼ì´ì–¸íŠ¸ ì¸¡ (ChatbotViewer)

```javascript
// SSE ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬
const reader = response.body.getReader();
const decoder = new TextDecoder();
let accumulatedText = '';
let buffer = '';

while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  const chunk = decoder.decode(value, { stream: true });
  buffer += chunk;
  
  // SSE í˜•ì‹ íŒŒì‹± (ì¤„ ë‹¨ìœ„)
  const lines = buffer.split('\n');
  buffer = lines.pop() || '';
  
  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6).trim());
      if (data.text) {
        accumulatedText += data.text;
        // ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        setMessages(prev => {
          // assistant ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        });
      }
      if (data.done) break;
    }
  }
}
```

### ì²­í¬ í…ìŠ¤íŠ¸ ì¶”ì¶œ

Langchainì˜ `RunnableWithMessageHistory.stream()`ì€ ë‹¤ì–‘í•œ í˜•ì‹ì˜ ì²­í¬ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì—¬ëŸ¬ í˜•ì‹ì„ ì²˜ë¦¬:

```javascript
function extractTextFromChunk(chunk) {
  if (typeof chunk === 'string') return chunk;
  if (chunk?.content) return chunk.content;
  if (chunk?.text) return chunk.text;
  if (chunk?.response) return chunk.response;
  if (chunk?.output) return chunk.output;
  return '';
}
```

---

## Langchain í†µí•©

### ë²„ì „
- **Langchain 1.x** (ìµœì‹  ë²„ì „)
- `@langchain/openai`: `^1.1.3`
- `@langchain/core`: `^1.1.4`
- `langchain`: `^1.1.5`

### ì£¼ìš” í´ë˜ìŠ¤

#### 1. ChatOpenAI
```javascript
const model = new ChatOpenAI({
  openAIApiKey: apiKey,
  modelName: 'gpt-3.5-turbo',
  temperature: 0.7,
  maxTokens: 3000,
  streaming: true,  // ìŠ¤íŠ¸ë¦¬ë° í™œì„±í™”
});
```

#### 2. ChatPromptTemplate
```javascript
const prompt = ChatPromptTemplate.fromMessages([
  ['system', systemMessage?.content || 'You are a helpful assistant.'],
  new MessagesPlaceholder('history'),  // ëŒ€í™” ê¸°ë¡ ìë¦¬í‘œì‹œì
  ['human', '{question}'],
]);
```

#### 3. InMemoryChatMessageHistory
```javascript
const chatHistory = new InMemoryChatMessageHistory();

// ê¸°ì¡´ ëŒ€í™” ê¸°ë¡ ë¡œë“œ
await chatHistory.addMessage(new HumanMessage(userMsg.content));
await chatHistory.addMessage(new AIMessage(assistantMsg.content));
```

#### 4. RunnableWithMessageHistory
```javascript
const chainWithHistory = new RunnableWithMessageHistory({
  runnable: prompt.pipe(model),  // LCEL ì²´ì¸
  getMessageHistory: async () => chatHistory,
  inputMessagesKey: 'question',
  historyMessagesKey: 'history',
});

// ìŠ¤íŠ¸ë¦¬ë° ì‹¤í–‰
const streamResponse = await chainWithHistory.stream(
  { question: currentUserMessage.content },
  { configurable: { sessionId: 'default-session' } }
);
```

### LCEL (LangChain Expression Language)

Langchain 1.xì—ì„œëŠ” LCELì„ ì‚¬ìš©í•˜ì—¬ ì²´ì¸ì„ êµ¬ì„±:

```javascript
// í”„ë¡¬í”„íŠ¸ì™€ ëª¨ë¸ì„ íŒŒì´í”„ë¡œ ì—°ê²°
const chain = prompt.pipe(model);
```

### ë©”ëª¨ë¦¬ ê´€ë¦¬

- **ì„œë²„ë¦¬ìŠ¤ í™˜ê²½**: ê° ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ `InMemoryChatMessageHistory` ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- **ëŒ€í™” ê¸°ë¡**: í´ë¼ì´ì–¸íŠ¸ì—ì„œ localStorageì— ì €ì¥í•˜ê³ , ìš”ì²­ ì‹œ ì„œë²„ë¡œ ì „ì†¡
- **ìë™ ì €ì¥**: `RunnableWithMessageHistory`ê°€ ì‘ë‹µì„ ìë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ì €ì¥ (ì„œë²„ ì¸¡ ë©”ëª¨ë¦¬ëŠ” ìš”ì²­ ì¢…ë£Œ ì‹œ ì†Œë©¸)

---

## Langchain 1.x ì—…ê·¸ë ˆì´ë“œ ì´ì 

### ë²„ì „ ì—…ê·¸ë ˆì´ë“œë¡œ ì–»ì€ ì£¼ìš” ì´ì 

#### 1. ê³µì‹ì ì¸ ìŠ¤íŠ¸ë¦¬ë° ì§€ì›
- **ì´ì „ (0.3.0)**: `ConversationChain.stream()`ì´ ë‹¨ì¼ í° ì²­í¬ë¡œ ë°˜í™˜ë˜ì–´ ì‹¤ì‹œê°„ ì¶œë ¥ì´ ì–´ë ¤ì›€
- **ì´í›„ (1.x)**: `RunnableWithMessageHistory.stream()`ì´ ì‹¤ì œë¡œ ì‹¤ì‹œê°„ ì²­í¬ë¥¼ ë°˜í™˜í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ
- **ê²°ê³¼**: SSE ìŠ¤íŠ¸ë¦¬ë°ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì—¬ ì‘ë‹µì´ ìƒì„±ë˜ëŠ” ì¦‰ì‹œ í‘œì‹œë¨

#### 2. LCEL (LangChain Expression Language) ë„ì…
- **ì´ì „**: ë³µì¡í•œ ì²´ì¸ êµ¬ì„± ë°©ì‹
- **ì´í›„**: ì§ê´€ì ì¸ íŒŒì´í”„ ì—°ì‚°ì ì‚¬ìš© (`prompt.pipe(model)`)
- **ê²°ê³¼**: ì½”ë“œ ê°€ë…ì„± í–¥ìƒ ë° ìœ ì§€ë³´ìˆ˜ ìš©ì´

#### 3. ê°œì„ ëœ ë©”ëª¨ë¦¬ ê´€ë¦¬
- **ì´ì „**: `BufferMemory` ì‚¬ìš© (ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ì—ì„œ ì œí•œì )
- **ì´í›„**: `RunnableWithMessageHistory` + `InMemoryChatMessageHistory` ì¡°í•©
- **ê²°ê³¼**: 
  - ë” ëª…í™•í•œ ë©”ëª¨ë¦¬ ê´€ë¦¬ API
  - ìë™ ë©”ì‹œì§€ ì €ì¥ ê¸°ëŠ¥
  - ì„¸ì…˜ ê¸°ë°˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ ì§€ì›

#### 4. ëª¨ë“ˆí™”ëœ íŒ¨í‚¤ì§€ êµ¬ì¡°
- **ì´ì „**: `langchain/memory`, `langchain/chains` ë“± ë‹¨ì¼ íŒ¨í‚¤ì§€ ë‚´ ê²½ë¡œ
- **ì´í›„**: `@langchain/core`, `@langchain/openai` ë“± ëª…í™•í•œ íŒ¨í‚¤ì§€ ë¶„ë¦¬
- **ê²°ê³¼**: 
  - í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒì ìœ¼ë¡œ import ê°€ëŠ¥
  - ë²ˆë“¤ í¬ê¸° ìµœì í™”
  - ë” ë‚˜ì€ íƒ€ì… ì§€ì›

#### 5. ìµœì‹  API ë° ìµœì í™”
- **ì´ì „**: êµ¬ë²„ì „ API ì‚¬ìš©
- **ì´í›„**: ìµœì‹  ìµœì í™”ëœ API
- **ê²°ê³¼**: 
  - ì„±ëŠ¥ ê°œì„ 
  - ë” ë‚˜ì€ ì—ëŸ¬ ì²˜ë¦¬
  - í–¥í›„ ê¸°ëŠ¥ í™•ì¥ ìš©ì´

#### 6. íƒ€ì… ì•ˆì •ì„± í–¥ìƒ
- **ì´ì „**: íƒ€ì… ì •ì˜ê°€ ë¶ˆì™„ì „
- **ì´í›„**: TypeScript íƒ€ì… ì •ì˜ê°€ ë” ì™„ì „í•˜ê³  ì •í™•í•¨
- **ê²°ê³¼**: ê°œë°œ ì‹œ íƒ€ì… ì²´í¬ë¡œ ë²„ê·¸ ì˜ˆë°©

#### 7. ê³µì‹ ë¬¸ì„œ ë° ì»¤ë®¤ë‹ˆí‹° ì§€ì›
- **ì´ì „**: êµ¬ë²„ì „ ë¬¸ì„œ ë° ì œí•œì ì¸ ì§€ì›
- **ì´í›„**: ìµœì‹  ê³µì‹ ë¬¸ì„œ ë° í™œë°œí•œ ì»¤ë®¤ë‹ˆí‹°
- **ê²°ê³¼**: ë¬¸ì œ í•´ê²°ì´ ë” ì‰¬ì›€

### ì—…ê·¸ë ˆì´ë“œ ì „í›„ ë¹„êµ

| í•­ëª© | Langchain 0.3.0 | Langchain 1.x | ê°œì„  íš¨ê³¼ |
|---|---|---|---|
| ìŠ¤íŠ¸ë¦¬ë° | ë‹¨ì¼ ì²­í¬ ë°˜í™˜ | ì‹¤ì‹œê°„ ì²­í¬ ë°˜í™˜ | âœ… ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ |
| ì²´ì¸ êµ¬ì„± | ë³µì¡í•œ API | LCEL íŒŒì´í”„ ì—°ì‚°ì | âœ… ì½”ë“œ ê°€ë…ì„± í–¥ìƒ |
| ë©”ëª¨ë¦¬ ê´€ë¦¬ | BufferMemory | RunnableWithMessageHistory | âœ… ë” ë‚˜ì€ êµ¬ì¡° |
| íŒ¨í‚¤ì§€ êµ¬ì¡° | ë‹¨ì¼ íŒ¨í‚¤ì§€ | ëª¨ë“ˆí™”ëœ íŒ¨í‚¤ì§€ | âœ… ë²ˆë“¤ í¬ê¸° ìµœì í™” |
| íƒ€ì… ì§€ì› | ì œí•œì  | ì™„ì „í•œ íƒ€ì… ì •ì˜ | âœ… ê°œë°œ ìƒì‚°ì„± í–¥ìƒ |
| ë¬¸ì„œ/ì§€ì› | êµ¬ë²„ì „ | ìµœì‹  ë¬¸ì„œ | âœ… ìœ ì§€ë³´ìˆ˜ ìš©ì´ |

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. Langchain ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ì´ìŠˆ

**ë¬¸ì œ**: Langchain 0.3.0ì—ì„œ 1.xë¡œ ì—…ê·¸ë ˆì´ë“œ ì‹œ import ê²½ë¡œ ë³€ê²½

**í•´ê²°**:
```javascript
// ì´ì „ (0.3.0)
import { BufferMemory } from 'langchain/memory';
import { ConversationChain } from 'langchain/chains';

// ì´í›„ (1.x)
import { InMemoryChatMessageHistory } from '@langchain/core/chat_history';
import { RunnableWithMessageHistory } from '@langchain/core/runnables';
```

### 2. ìŠ¤íŠ¸ë¦¬ë° ì‹¤ì‹œê°„ ì¶œë ¥ ë¬¸ì œ

**ë¬¸ì œ**: ìŠ¤íŠ¸ë¦¬ë°ì€ ë˜ì§€ë§Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œë ¥ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: `ConversationChain.stream()`ì´ ë‹¨ì¼ í° ì²­í¬ë¡œ ë°˜í™˜

**í•´ê²°**: Langchain 1.xì˜ `RunnableWithMessageHistory.stream()` ì‚¬ìš©

### 3. "ìƒê° ì¤‘..." ë©”ì‹œì§€ ì¤‘ë³µ

**ë¬¸ì œ**: ì§ˆë¬¸ ì‹œ "ìƒê° ì¤‘..." ë§í’ì„ ì´ ì¤‘ë³µ í‘œì‹œ

**ì›ì¸**: ë¹ˆ assistant ë©”ì‹œì§€ì™€ "ìƒê° ì¤‘..." ë©”ì‹œì§€ê°€ ë™ì‹œì— ë Œë”ë§

**í•´ê²°**:
```javascript
// ë¹ˆ assistant ë©”ì‹œì§€ëŠ” ë Œë”ë§í•˜ì§€ ì•ŠìŒ
{messages.map((message, index) => {
  if (message.role === 'assistant' && !message.content) {
    return null;
  }
  // ... ë Œë”ë§
})}
```

### 4. SSE íŒŒì‹± ì—ëŸ¬

**ë¬¸ì œ**: `SyntaxError: Unexpected token 'd', "data: {"te"... is not valid JSON`

**ì›ì¸**: ë¶ˆì™„ì „í•œ SSE ë¼ì¸ì„ JSONìœ¼ë¡œ íŒŒì‹± ì‹œë„

**í•´ê²°**: ë²„í¼ë¥¼ ì‚¬ìš©í•˜ì—¬ ì™„ì „í•œ ë¼ì¸ë§Œ íŒŒì‹±
```javascript
const lines = buffer.split('\n');
buffer = lines.pop() || '';  // ë§ˆì§€ë§‰ ë¶ˆì™„ì „í•œ ë¼ì¸ì€ ë²„í¼ì— ìœ ì§€
```

### 5. sessionId í•„ìˆ˜ ì—ëŸ¬

**ë¬¸ì œ**: `sessionId is required` ì—ëŸ¬

**ì›ì¸**: `RunnableWithMessageHistory`ëŠ” `sessionId`ê°€ í•„ìˆ˜

**í•´ê²°**:
```javascript
await chainWithHistory.stream(
  { question: currentUserMessage.content },
  { configurable: { sessionId: 'default-session' } }
);
```

### 6. ë©”ì„œë“œëª… ë³€ê²½

**ë¬¸ì œ**: `addAIChatMessage is not a function`

**ì›ì¸**: `InMemoryChatMessageHistory`ëŠ” `addMessage()`ë§Œ ì œê³µ

**í•´ê²°**:
```javascript
// ì´ì „
await chatHistory.addAIChatMessage(content);

// ì´í›„
await chatHistory.addMessage(new AIMessage(content));
```

---

## í–¥í›„ ê°œì„  ì‚¬í•­

### 1. ì„œë²„ ì¸¡ ë©”ëª¨ë¦¬ ê´€ë¦¬
- í˜„ì¬ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ëŒ€í™” ê¸°ë¡ì„ ê´€ë¦¬
- í–¥í›„ DB êµ¬ì¶• ì‹œ ì„œë²„ ì¸¡ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¡œ ì „í™˜
- `SummaryMemory` ë„ì… ê²€í†  (í† í° íš¨ìœ¨ì„± í–¥ìƒ)

### 2. ì„¸ì…˜ ê´€ë¦¬
- í˜„ì¬ëŠ” ëª¨ë“  ì‚¬ìš©ìê°€ ë™ì¼í•œ `default-session` ì‚¬ìš©
- ì‚¬ìš©ìë³„ ê³ ìœ  ì„¸ì…˜ ID ìƒì„±
- ë‹¤ì¤‘ ëŒ€í™” ì„¸ì…˜ ì§€ì›

### 3. ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì‹œ ì¬ì‹œë„ ë¡œì§
- íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬
- ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€

### 4. ì„±ëŠ¥ ìµœì í™”
- ëŒ€í™” ê¸°ë¡ì´ ê¸¸ì–´ì§ˆ ë•Œ ìš”ì•½ ê¸°ëŠ¥
- í† í° ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
- ì‘ë‹µ ìºì‹± (ë™ì¼ ì§ˆë¬¸ì— ëŒ€í•´)

### 5. UI/UX ê°œì„ 
- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ê°œì„ 
- ì½”ë“œ ë¸”ë¡ í•˜ì´ë¼ì´íŒ…
- ë³µì‚¬ ë²„íŠ¼ ì¶”ê°€
- ë©”ì‹œì§€ í¸ì§‘/ì‚­ì œ ê¸°ëŠ¥

### 6. ê¸°ëŠ¥ í™•ì¥
- ì´ë¯¸ì§€ ì—…ë¡œë“œ ì§€ì›
- íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥
- ë¬¸ì œ ë§í¬ ìë™ ì¸ì‹
- ì½”ë“œ ì‹¤í–‰ ê²°ê³¼ í™•ì¸

---

## ì°¸ê³  ìë£Œ

- [Langchain ê³µì‹ ë¬¸ì„œ](https://js.langchain.com/)
- [OpenAI API ë¬¸ì„œ](https://platform.openai.com/docs)
- [Next.js API Routes](https://nextjs.org/docs/api-routes/introduction)
- [Server-Sent Events (MDN)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)

---

## ë³€ê²½ ì´ë ¥

### 2024-01-XX
- ì´ˆê¸° ì±—ë´‡ ê¸°ëŠ¥ êµ¬í˜„
- Langchain 0.3.0 í†µí•©

### 2024-01-XX
- Langchain 1.xë¡œ ì—…ê·¸ë ˆì´ë“œ
- `RunnableWithMessageHistory` ë„ì…
- SSE ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„

### 2024-01-XX
- ë ˆê±°ì‹œ ì½”ë“œ ì •ë¦¬
- "ìƒê° ì¤‘..." ì¤‘ë³µ ë¬¸ì œ í•´ê²°
- ë¬¸ì„œí™” ì™„ë£Œ

---

**ì‘ì„±ì¼**: 2024-01-XX  
**ì‘ì„±ì**: AI Assistant  
**ë²„ì „**: 1.0.0

